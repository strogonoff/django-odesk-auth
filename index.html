<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>django-odesk-auth by strogonoff</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>django-odesk-auth</h1>
        <p>Django app for simple “Log in via oDesk” functionality. Authentication backend and a couple of views.</p>

        <p class="view"><a href="https://github.com/strogonoff/django-odesk-auth">View the Project on GitHub <small>strogonoff/django-odesk-auth</small></a></p>


        <ul>
          <li><a href="https://github.com/strogonoff/django-odesk-auth/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/strogonoff/django-odesk-auth/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/strogonoff/django-odesk-auth">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="simple-odesk-login-for-your-django-based-project" class="anchor" href="#simple-odesk-login-for-your-django-based-project"><span class="octicon octicon-link"></span></a>Simple oDesk login for your Django-based project</h1>

<pre><code>$ pip install django-odesk-auth
</code></pre>

<h2>
<a name="creating-odesk-oauth-api-key" class="anchor" href="#creating-odesk-oauth-api-key"><span class="octicon octicon-link"></span></a>Creating oDesk OAuth API key</h2>

<p>Go to <a href="https://www.odesk.com/services/api/apply">https://www.odesk.com/services/api/apply</a>.</p>

<ul>
<li>Authentication type should be set to "OAuth 1.0".</li>
<li>Callback URL should be left blank.</li>
<li>Permission "View the structure of your companies/teams" is currently
required to be checked.</li>
</ul><h2>
<a name="quick-start" class="anchor" href="#quick-start"><span class="octicon octicon-link"></span></a>Quick start</h2>

<p>Provided you have installed <code>django-odesk-auth</code> and <code>python-odesk==0.5</code>.</p>

<ol>
<li><p>Add <code>django_odesk_auth</code> to INSTALLED_APPS.
Make sure you have <code>django.contrib.sites</code> app in INSTALLED_APPS as well.</p></li>
<li><p>Add <code>django_odesk_auth.backends.ODeskOAuthBackend</code>
to AUTHENTICATION_BACKENDS.</p></li>
<li><p>Specify <code>ODESK_OAUTH_KEY</code> and <code>ODESK_OAUTH_SECRET</code> settings
with your key information.</p></li>
<li><p>Add <a href="mailto:your_username@odesk.com">your_username@odesk.com</a> to <code>ODESK_AUTH_ALLOWED_USERS</code>,
and set <code>ODESK_AUTH_CREATE_UNKNOWN_USER</code> to True.</p></li>
<li><p>Include <code>django_odesk_auth.urls</code> in your URL patterns.</p></li>
<li><p>In your login page template, put a link "Log in via oDesk" and point it
to <code>{% url "odesk_oauth_login" %}</code>.</p></li>
<li><p>Open login page and click "Log in via oDesk" to verify everything works.</p></li>
</ol><p>Important: keep <code>ODESK_OAUTH_KEY</code> and <code>ODESK_OAUTH_SECRET</code> settings in a file
that is not under version control.</p>

<h2>
<a name="example-project" class="anchor" href="#example-project"><span class="octicon octicon-link"></span></a>Example project</h2>

<p>Install <code>django==1.6</code> and <code>python-odesk==0.5</code> (better do this
in virtual Python environment created specifically for example project).</p>

<p>Fill in some critical settings in <code>example_project/settings.py</code> (see comments),
then run <code>./manage.py syncdb</code>, then you can run development server and
open <code>localhost:8000</code>.</p>

<h2>
<a name="access-control" class="anchor" href="#access-control"><span class="octicon octicon-link"></span></a>Access control</h2>

<p>App has basic access control facilities.</p>

<p>You can specify who is allowed to log in to your site and who upon login gets
staff and/or superuser statuses. This is configured through Django settings.</p>

<p>Currently access control cannot be turned off.
You <strong>have</strong> to explicitly specify at least who is allowed to log in to your site.
(Yes, this means you can't grant access to everyone yet, unless you hack the app.)</p>

<p>Users that aren't allowed to log in get <code>User.is_active</code> flag set to False.
See <code>utils.update_user_permissions()</code> definition if you're interested in other specifics,
and see available settings below.</p>

<h2>
<a name="making-authenticated-odesk-api-calls" class="anchor" href="#making-authenticated-odesk-api-calls"><span class="octicon octicon-link"></span></a>Making authenticated oDesk API calls</h2>

<p>After user is successfully authenticated, you can call oDesk API on their behalf.</p>

<p>Here's a quick example::</p>

<pre><code>from django_odesk_auth import utils, O_ACCESS_TOKEN

odesk_client = utils.get_client(request.session[O_ACCESS_TOKEN])
print odesk_client.hr.get_teams()
# Should output list of teams user has access to
</code></pre>

<p>Some notes:</p>

<ul>
<li><p>How you make API calls is up to you. Internally django-odesk-auth
uses python-odesk library, and so does this example.</p></li>
<li><p><code>utils.get_client()</code> function returns an instance of <code>odesk.Client</code>.
Handy if you're using python-odesk library to make API calls.</p></li>
<li><p>OAuth access token, obtained during authentication, is stored
under <code>request.session[O_ACCESS_TOKEN]</code>.</p></li>
</ul><h2>
<a name="checking-oauth-access-token" class="anchor" href="#checking-oauth-access-token"><span class="octicon octicon-link"></span></a>Checking OAuth access token</h2>

<p>Sometimes there's a need to make sure that current user's authentication
is still valid—that they, for example, didn't revoke access to their account.</p>

<p>For that you can use <code>utils.check_login()</code> in Python, or make an AJAX request
to named URL <code>'odesk_oauth_check_login'</code> from client side
(see <code>views.oauth_check_login</code>).</p>

<h2>
<a name="available-django-settings" class="anchor" href="#available-django-settings"><span class="octicon octicon-link"></span></a>Available Django settings</h2>

<p>ODESK_OAUTH_KEY, ODESK_OAUTH_SECRET<br>
  API key information.</p>

<p>ODESK_AUTH_CREATE_UNKNOWN_USER = False<br>
  Whether to create a new account in Django if given user logs in via oDesk
  for the first time.</p>

<p>ODESK_AUTH_ALLOWED_USERS = ()<br>
  oDesk emails of users who are allowed to log in via oDesk.</p>

<p>ODESK_AUTH_ADMINS = ()<br>
  oDesk emails of users who are marked as <code>is_staff</code> upon login.</p>

<p>ODESK_AUTH_SUPERUSERS = ()<br>
  oDesk emails of users who are marked as <code>is_superuser</code> upon login.</p>

<p>ODESK_AUTH_ALLOWED_TEAMS = ()<br>
  IDs of oDesk teams, members of which are allowed to log in via oDesk.</p>

<p>ODESK_AUTH_ADMIN_TEAMS = ()<br>
  IDs of oDesk teams, members of which are marked as <code>is_staff</code> upon login.</p>

<p>ODESK_AUTH_SUPERUSER_TEAMS = ()<br>
  IDs of oDesk teams, members of which are marked as <code>is_superuser</code> upon login.</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/strogonoff">strogonoff</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-24538431-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>