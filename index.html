<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>django-odesk-auth by strogonoff</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">django-odesk-auth</h1>
      <h2 class="project-tagline">Django app for simple “Log in via oDesk” functionality. Authentication backend and a couple of views.</h2>
      <a href="https://github.com/strogonoff/django-odesk-auth" class="btn">View on GitHub</a>
      <a href="https://github.com/strogonoff/django-odesk-auth/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/strogonoff/django-odesk-auth/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="simple-odesk-login-for-your-django-based-project" class="anchor" href="#simple-odesk-login-for-your-django-based-project" aria-hidden="true"><span class="octicon octicon-link"></span></a>Simple oDesk login for your Django-based project</h1>

<pre><code>$ pip install django-odesk-auth
</code></pre>

<p><strong>Note: oDesk is called Upwork since May 5, 2015, and their APIs have migrated to another domain.</strong>
They promised to continue supporting oDesk APIs until May 19, 2015.
A backwards-compatible release to this library is planned to be made before that date. New version will
depend on <code>python-upwork</code> instead of <code>python-odesk</code>
and therefore use API endpoints hosted on upwork.com instead of odesk.com.
Then, support will be continued only for the new <code>django-upwork-auth</code>, which is in the works.
(See <a href="https://github.com/strogonoff/django-odesk-auth/issues/4">#4</a>.)</p>

<h2>
<a id="creating-odesk-oauth-api-key" class="anchor" href="#creating-odesk-oauth-api-key" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating oDesk OAuth API key</h2>

<p>Go to <a href="https://www.odesk.com/services/api/apply">https://www.odesk.com/services/api/apply</a>.</p>

<ul>
<li>Authentication type should be set to "OAuth 1.0".</li>
<li>Callback URL should be left blank.</li>
<li>Permission "View the structure of your companies/teams" is currently
required to be checked.</li>
</ul>

<h2>
<a id="quick-start" class="anchor" href="#quick-start" aria-hidden="true"><span class="octicon octicon-link"></span></a>Quick start</h2>

<p>Provided you have installed <code>django-odesk-auth</code> and <code>python-odesk==0.5</code>.</p>

<ol>
<li><p>Add <code>django_odesk_auth</code> to INSTALLED_APPS.
Make sure you have <code>django.contrib.sites</code> app in INSTALLED_APPS as well.</p></li>
<li><p>Add <code>django_odesk_auth.backends.ODeskOAuthBackend</code>
to AUTHENTICATION_BACKENDS.</p></li>
<li><p>Specify <code>ODESK_OAUTH_KEY</code> and <code>ODESK_OAUTH_SECRET</code> settings
with your key information.</p></li>
<li><p>Add <a href="mailto:your_username@odesk.com">your_username@odesk.com</a> to <code>ODESK_AUTH_ALLOWED_USERS</code>,
and set <code>ODESK_AUTH_CREATE_UNKNOWN_USER</code> to True.</p></li>
<li><p>Include <code>django_odesk_auth.urls</code> in your URL patterns.</p></li>
<li><p>In your login page template, put a link "Log in via oDesk" and point it
to <code>{% url "odesk_oauth_login" %}</code>.</p></li>
<li><p>Open login page and click "Log in via oDesk" to verify everything works.</p></li>
</ol>

<p>Important: keep <code>ODESK_OAUTH_KEY</code> and <code>ODESK_OAUTH_SECRET</code> settings in a file
that is not under version control.</p>

<h2>
<a id="example-project" class="anchor" href="#example-project" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example project</h2>

<p>Install <code>django==1.6</code> and <code>python-odesk==0.5</code> (better do this
in virtual Python environment created specifically for example project).</p>

<p>Fill in some critical settings in <code>example_project/settings.py</code> (see comments),
then run <code>./manage.py syncdb</code>, then you can run development server and
open <code>localhost:8000</code>.</p>

<h2>
<a id="access-control" class="anchor" href="#access-control" aria-hidden="true"><span class="octicon octicon-link"></span></a>Access control</h2>

<p>App has basic access control facilities.</p>

<p>You can specify who is allowed to log in to your site and who upon login gets
staff and/or superuser statuses. This is configured through Django settings.</p>

<p>Currently access control cannot be turned off.
You <strong>have</strong> to explicitly specify at least who is allowed to log in to your site.
(Yes, this means you can't grant access to everyone yet, unless you hack the app.)</p>

<p>Users that aren't allowed to log in get <code>User.is_active</code> flag set to False.
See <code>utils.update_user_permissions()</code> definition if you're interested in other specifics,
and see available settings below.</p>

<h2>
<a id="making-authenticated-odesk-api-calls" class="anchor" href="#making-authenticated-odesk-api-calls" aria-hidden="true"><span class="octicon octicon-link"></span></a>Making authenticated oDesk API calls</h2>

<p>After user is successfully authenticated, you can call oDesk API on their behalf.</p>

<p>Here's a quick example::</p>

<pre><code>from django_odesk_auth import utils, O_ACCESS_TOKEN

odesk_client = utils.get_client(request.session[O_ACCESS_TOKEN])
print odesk_client.hr.get_teams()
# Should output list of teams user has access to
</code></pre>

<p>Some notes:</p>

<ul>
<li><p>How you make API calls is up to you. Internally django-odesk-auth
uses python-odesk library, and so does this example.</p></li>
<li><p><code>utils.get_client()</code> function returns an instance of <code>odesk.Client</code>.
Handy if you're using python-odesk library to make API calls.</p></li>
<li><p>OAuth access token, obtained during authentication, is stored
under <code>request.session[O_ACCESS_TOKEN]</code>.</p></li>
</ul>

<h2>
<a id="checking-oauth-access-token" class="anchor" href="#checking-oauth-access-token" aria-hidden="true"><span class="octicon octicon-link"></span></a>Checking OAuth access token</h2>

<p>Sometimes there's a need to make sure that current user's authentication
is still valid—that they, for example, didn't revoke access to their account.</p>

<p>For that you can use <code>utils.check_login()</code> in Python, or make an AJAX request
to named URL <code>'odesk_oauth_check_login'</code> from client side
(see <code>views.oauth_check_login</code>).</p>

<h2>
<a id="available-django-settings" class="anchor" href="#available-django-settings" aria-hidden="true"><span class="octicon octicon-link"></span></a>Available Django settings</h2>

<p>ODESK_OAUTH_KEY, ODESK_OAUTH_SECRET<br>
  API key information.</p>

<p>ODESK_AUTH_CREATE_UNKNOWN_USER = False<br>
  Whether to create a new account in Django if given user logs in via oDesk
  for the first time.</p>

<p>ODESK_AUTH_ALLOWED_USERS = ()<br>
  oDesk emails of users who are allowed to log in via oDesk.</p>

<p>ODESK_AUTH_ADMINS = ()<br>
  oDesk emails of users who are marked as <code>is_staff</code> upon login.</p>

<p>ODESK_AUTH_SUPERUSERS = ()<br>
  oDesk emails of users who are marked as <code>is_superuser</code> upon login.</p>

<p>ODESK_AUTH_ALLOWED_TEAMS = ()<br>
  IDs of oDesk teams, members of which are allowed to log in via oDesk.</p>

<p>ODESK_AUTH_ADMIN_TEAMS = ()<br>
  IDs of oDesk teams, members of which are marked as <code>is_staff</code> upon login.</p>

<p>ODESK_AUTH_SUPERUSER_TEAMS = ()<br>
  IDs of oDesk teams, members of which are marked as <code>is_superuser</code> upon login.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/strogonoff/django-odesk-auth">django-odesk-auth</a> is maintained by <a href="https://github.com/strogonoff">strogonoff</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-24538431-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>

